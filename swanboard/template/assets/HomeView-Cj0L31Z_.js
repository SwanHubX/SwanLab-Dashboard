import{_ as e,u as t,c as a,o as l,a as s,b as o,t as r,d as n,e as u,f as i,r as d,h as c,m as v,g as p,w as m,n as f,R as h,i as y,j as b,k as x,l as w,p as g,q as k,F as _,s as $,v as j,x as E,y as L,z as B,A as S,B as T,S as A,C as I,D as M,E as C,G as H,H as R,I as z,J as U}from"./index-CSrWMW-P.js";import{_ as W,D as q,a as D}from"./SLStatusLabel-CvQbZ0sr.js";import"./SLLoading-DNmSjfVT.js";const G={class:"w-full h-full pt-5 flex flex-col"},N={class:"px-6 border-b flex-shrink-0"},O={class:"project-title transition-marging duration-300"},P={class:"flex items-center gap-3"},X={class:"text-2xl items-center gap-1 font-semibold max-w-md truncate"},F={class:"flex justify-end grow transition-padding duration-300 ml-1"},J={key:0,class:"project-description"},V=e({__name:"HomeLayout",setup(e){const p=t(),m=async(e,t)=>{const{data:a}=await c.patch("/project/update",e);p.updateInfo(a.updates),t()},f=a((()=>{for(const e of p.experiments)if(0===e.status)return!0;return!1})),h=()=>{c.delete("/project").then((()=>{v.success("Delete Successfully"),location.reload()})).catch((()=>{v.error("Error deleting project")}))};return(e,t)=>(l(),s("div",G,[o("div",N,[o("div",O,[o("div",P,[o("h1",X,r(n(p).name),1),u(W,{type:"project",onModify:m})]),o("div",F,[u(q,{type:"project",onConfirm:h,disabled:f.value},null,8,["disabled"])])]),n(p).description?(l(),s("p",J,r(n(p).description),1)):i("",!0),d(e.$slots,"top",{},void 0,!0)]),d(e.$slots,"default",{},void 0,!0)]))}},[["__scopeId","data-v-c54d48e0"]]),K=["title"],Q={__name:"ExperimentName",props:{name:{type:String,required:!0},color:{type:String,required:!0},id:{required:!0}},setup:e=>(t,a)=>(l(),p(n(h),{class:"flex gap-2 items-center w-full",to:`/experiment/${e.id}`},{default:m((()=>[o("circle",{class:"w-3 h-3 rounded-full flex-shrink-0",style:f({backgroundColor:t.$props.color})},null,4),o("p",{class:"truncate",title:e.name},r(e.name),9,K)])),_:1},8,["to"]))},Y={class:"border-y flex bg-higher table-header"},Z=["onMouseover"],ee=["title"],te=["onMousedown"],ae=["title","onMouseover"],le={key:0,class:"w-full overflow-hidden"},se={key:1,class:"w-full overflow-hidden"},oe={key:0,class:"flex justify-center py-3 border border-t-0"},re={class:"data-empty"},ne=e({__name:"ExprTable",props:{data:{type:Array,default:()=>[]},column:{type:Array,default:()=>[]},maxW:{type:String,default:"none"},highLight:{type:Boolean,default:!0},flexable:{type:Boolean,default:!1},lastRowGradient:{type:Boolean,default:!1},tableBorder:{type:Boolean,default:!1},stickyHeader:{type:Boolean,default:!1}},setup(e){const t=e,n=y(null),u=y([]),c=y(null),v=y(null),p=y("100%"),m=a((()=>{if(t.flexable){const e=t.column.length;return new Array(e).fill(1/e*100+"%")}return u.value.map((e=>(null==e?void 0:e.value)?(null==e?void 0:e.value)+"px":""))})),h=y(-1),j=a((()=>-1===B.value?h.value:B.value));b((()=>{t.column.forEach(((e,t)=>{if(u.value[t]={value:0,extended:!1},e.width){const a=e.width>150?e.width:150;u.value[t].value=e.border?a-2:a}else u.value[t].value=150})),E(),window.addEventListener("resize",E)})),x((()=>{window.removeEventListener("resize",E)}));const E=()=>{var e;let t=0;u.value.forEach((({value:e})=>{t+=e})),(null==(e=v.value)?void 0:e.offsetWidth)>t?v.value.offsetWidth&&(p.value=v.value.offsetWidth):p.value=t},L=w("isSideBarShow");g(L,(e=>{t.flexable||(e?p.value-=288:p.value+=288)}));const B=y(-1),S=y(0),T=y(0),A=y(70),I=e=>{let t=T.value+(e.clientX-S.value);t=t<A.value?A.value:t,u.value[B.value].value=t,n.value[B.value]=t},M=()=>{E(),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",M),document.body.style.userSelect="auto",document.body.style.cursor="",S.value=0,T.value=0,B.value=-1},C=e=>{h.value=e};return(t,a)=>(l(),s("div",{class:"w-full",ref_key:"wrapper",ref:v},[o("div",{class:k({"gradient-last-line":e.lastRowGradient,"table-border":e.tableBorder}),style:f({width:"string"==typeof p.value?p.value:`${p.value}px`}),ref_key:"table",ref:c},[o("div",{class:k({"sticky top-0 z-20":e.stickyHeader})},[o("div",Y,[(l(!0),s(_,null,$(e.column,((t,d)=>(l(),s("div",{key:t.key,class:k(["cell table-header-item",j.value===d?"bg-highest":"bg-higher"]),onMouseover:e=>C(d),onMouseout:a[0]||(a[0]=e=>C(-1)),style:f({width:m.value[d]}),ref_for:!0,ref_key:"columnsRef",ref:n},[o("p",{class:k(["overflow-hidden w-full h-full flex items-center",t.style||"px-2 py-3"]),title:t.title},r(t.title),11,ee),e.column.unresizeable||e.flexable?i("",!0):(l(),s("button",{key:0,onMousedown:e=>((e,t)=>{console.log(`准备重置第${t}的宽度`),document.body.style.userSelect="none",document.body.style.cursor="col-resize",B.value=t,S.value=e.clientX,m.value[t].endsWith("%")&&(u.value[t].value=n.value[t].offsetWidth),T.value=u.value[t].value,document.addEventListener("mousemove",I),document.addEventListener("mouseup",M)})(e,d),class:k({"button-hover-tip":h.value===d})},null,42,te))],46,Z)))),128))])],2),(l(!0),s(_,null,$(e.data,((o,n)=>(l(),s("div",{key:o,class:k([{"hover:bg-higher":-1===B.value},"line"])},[(l(!0),s(_,null,$(e.column,((e,u)=>(l(),s("div",{key:e.key,title:o[e.key],class:k(["cell flex items-center px-2 py-3",[e.style,{"hover:bg-primary-dimmest":-1===B.value},j.value===u?"bg-higher":"bg-default"]]),onMouseover:e=>C(u),onMouseout:a[1]||(a[1]=e=>C(-1)),style:f({width:m.value[u]})},[e.slot?(l(),s("div",le,[d(t.$slots,e.slot,{row:o,index:n},void 0,!0)])):(l(),s("div",se,r(o[e.key]||"-"),1))],46,ae)))),128))],2)))),128)),e.data.length?i("",!0):(l(),s("div",oe,[o("div",re,r(t.$t("common.table.empty")),1)]))],6)],512))}},[["__scopeId","data-v-1c6c498d"]]),ue={class:"flex-col justify-center items-center pt-10"},ie=(e=>(j("data-v-bcdae545"),e=e(),E(),e))((()=>o("div",{class:"loader"},null,-1))),de={class:"text-center pt-10 text-lg"},ce=e({__name:"EmptyTable",setup:e=>(e,t)=>(l(),s("div",ue,[ie,o("p",de,r(e.$t("home.empty.table")),1)]))},[["__scopeId","data-v-bcdae545"]]),ve=["checked","disabled"],pe={class:"select-none truncate"},me=e({__name:"SLCheck",props:{label:{type:String,default:""},checked:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:checked"],setup:e=>(t,a)=>(l(),s("div",{class:k(["flex items-center gap-2",{"cursor-pointer":!e.disabled}]),onClick:a[0]||(a[0]=a=>!e.disabled&&t.$emit("update:checked",!e.checked))},[o("input",{type:"checkbox",checked:e.checked&&!e.disabled,disabled:e.disabled},null,8,ve),o("span",pe,r(e.label),1)],2))},[["__scopeId","data-v-b757f214"]]),fe={class:"w-full flex justify-between items-center"},he={class:"flex gap-5 items-center pl-10"},ye={__name:"TableBar",props:{tableBody:{type:Array,default:()=>[]},tableHead:{type:Array,default:()=>[]},checked:{type:Boolean,default:!1},searchText:{type:String,default:""}},emits:["update:checked","update:searchText"],setup(e){const t=(e,t,a)=>{switch(t){case"config":return e.config[a]?e.config[a].value:"-";case"create_time":return T(e.create_time);case"status":return S(`experiment.status.${e.status}`);case"duration":return B(e)}};return(a,n)=>{const i=A,d=I,c=M;return l(),s("div",fe,[u(i,{class:"max-w-[400px]",onInput:n[0]||(n[0]=e=>a.$emit("update:searchText",e)),placeholder:a.$t("experiment.index.header.table-bar.placeholder")},null,8,["placeholder"]),o("div",he,[u(me,{label:a.$t("experiment.index.header.table-bar.summary"),checked:e.checked,"onUpdate:checked":n[1]||(n[1]=e=>a.$emit("update:checked",e))},null,8,["label","checked"]),u(c,{theme:"default",class:"px-3 py-2 rounded-lg flex items-center gap-2",onClick:n[2]||(n[2]=a=>function(e,a){if(!(e&&a&&Array.isArray(e)&&Array.isArray(a)&&e.length&&a.length))return;let{year:l,month:s,day:o,hour:r,minute:n,second:u}=L((new Date).getTime()-288e5);const i=`swanlab_experiments_${l}-${s}-${o}_${r}-${n}-${u}.csv`;var d="data:text/csv;charset=utf-8,\ufeff";const c=e.map((e=>e.title)).join(",");d+=c+"\n",a.forEach(((l,s)=>{let o="";for(let a=0;a<e.length;a++){const s=e[a],r=s.key||s.slot,n=s.type?t(l,s.type,r):l[r]||"-";o+=("string"==typeof n?n.replace(/,/g,"，"):n)+","}d+=s<a.length?o.replace(/,$/,"\n"):o.replace(/,$/,"")}));const v=document.createElement("a");v.href=encodeURI(d),v.download=i,v.click(),window.URL.revokeObjectURL(d)}(e.tableHead,e.tableBody)),hollow:""},{default:m((()=>[u(d,{icon:"download",class:"w-4 h-4"}),o("span",null,r(a.$t("experiment.index.header.table-bar.export")),1)])),_:1})])])}}},be={class:"w-80 flex flex-col gap-4 my-5 text-dimmer"},xe={class:"flex justify-between"},we={class:"grow"},ge={class:"w-36 whitespace-nowrap"},ke={class:"flex justify-between"},_e={class:"grow"},$e={class:"w-36 whitespace-nowrap"},je={class:"flex justify-between"},Ee={class:"grow"},Le={class:"w-36 whitespace-nowrap"},Be={class:"pt-5 flex flex-col flex-grow flex-shrink-0"},Se={class:"flex mx-6 mb-4 items-center gap-1.5 flex-shrink-0"},Te={class:"text-xl font-semibold"},Ae={key:0,class:"bg-highest text-default rounded-full px-3"},Ie={key:0,class:"w-full pb-10 flex flex-col overflow-scroll flex-grow basis-0"},Me={key:2},Ce=e({__name:"HomeView",setup(e){const d=t(),v=a((()=>void 0===d.experiments?[]:d.experiments)),f=y(!1);b((()=>{setTimeout((()=>{f.value=!0}),500)}));const h=a((()=>T(d.createTime))),x=a((()=>T(d.updateTime))),w=a((()=>{var e;return(null==(e=d.experiments)?void 0:e.length)||0})),g=y([{title:S("home.list.table.header.name"),slot:"name",style:"px-6",width:300,border:!0},{title:S("home.list.table.header.status"),slot:"status",type:"status"},{title:S("home.list.table.header.create"),slot:"create",type:"create_time"},{title:S("home.list.table.header.duration"),slot:"duration",type:"duration"}]),k=y([]);v.value.map((e=>{Object.entries(e.config).forEach((([e])=>{k.value.some((t=>t.title===e))||k.value.push({type:"config",slot:e,title:e})}))}));const j=a((()=>v.value.map((e=>{const t=L.value[e.name];return t?(Promise.all(Object.keys(t).map((async a=>{e[await A(a)]=isNaN(t[a])?t[a]:C(t[a])}))),e):{}})))),E=y(),L=y({});async function A(e){return"swanlab-overview-table-key"+e}c.get("/project/summaries",{params:{experiment_names:(()=>{let e=[];return v.value.forEach((t=>{e.push(t.name)})),e.join(",")})()}}).then((async({data:e})=>{E.value=await Promise.all(e.tags.map((async e=>({key:await A(e),title:e})))),L.value=e.summaries}));const I=y(!1),M=a((()=>I.value?[g.value[0],...E.value]:[...g.value,...k.value,...E.value||[]])),W=y(""),q=a((()=>W.value?j.value.filter((e=>e.name.toLowerCase().includes(W.value.toLowerCase()))):j.value));return(e,t)=>{const a=V;return l(),p(a,null,{top:m((()=>[o("div",be,[o("div",xe,[o("div",we,r(e.$t("home.overview.create")),1),o("p",ge,r(h.value),1)]),o("div",ke,[o("div",_e,r(e.$t("home.overview.latest")),1),o("p",$e,r(x.value),1)]),o("div",je,[o("div",Ee,r(e.$t("home.overview.logdir")),1),o("p",Le,r(n(d).logdir),1)])])])),default:m((()=>[o("div",Be,[o("div",Se,[o("h2",Te,r(e.$t("home.list.title")),1),w.value?(l(),s("span",Ae,r(w.value),1)):i("",!0)]),u(ye,{class:"pb-4 pt-1 px-5 flex-shrink-0","table-head":M.value,"table-body":q.value,searchText:W.value,checked:I.value,"onUpdate:checked":t[0]||(t[0]=e=>I.value=e),"onUpdate:searchText":t[1]||(t[1]=e=>W.value=e)},null,8,["table-head","table-body","searchText","checked"]),E.value&&f.value?(l(),s("div",Ie,[u(ne,{"sticky-header":"",class:"dashboard-table",column:M.value,data:q.value,"last-row-gradient":""},H({name:m((({row:e})=>{return[u(Q,{name:e.name,id:e.id,color:(t=e,t.light)},null,8,["name","id","color"])];var t})),status:m((({row:t})=>[u(D,{name:t.name,status:t.status,url:"/experiment/"+t.id},{default:m((()=>[R(r(e.$t("experiment.status."+t.status)),1)])),_:2},1032,["name","status","url"])])),create:m((({row:e})=>[R(r(n(z)(n(U)(e.create_time))),1)])),duration:m((({row:e})=>[R(r(n(B)(e)),1)])),_:2},[$(k.value,(e=>({name:e.slot,fn:m((({row:t})=>{var a,l;return[R(r(null!=(null==(a=t.config[e.slot])?void 0:a.value)?null==(l=t.config[e.slot])?void 0:l.value:"-"),1)]}))})))]),1032,["column","data"])])):0===v.value.length&&f.value?(l(),p(ce,{key:1})):(l(),s("div",Me,[(l(),s(_,null,$(3,(e=>o("div",{class:"w-full flex",key:e},[(l(),s(_,null,$(5,(e=>o("div",{key:e,class:"skeleton w-full py-3 m-2"}))),64))]))),64))]))])])),_:1})}}},[["__scopeId","data-v-a3558d37"]]);export{Ce as default};
